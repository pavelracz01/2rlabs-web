version: '3.8'
services:
  testar-web:
    build:
      context: .
      args:
        NEXT_PUBLIC_BASE_PATH: ${PATH_PREFIX:-/testar}
    container_name: ${CONTAINER_NAME:-testar-prod}
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.${CONTAINER_NAME:-testar-prod}.rule=PathPrefix(`${PATH_PREFIX:-/testar}`)"
      - "traefik.http.routers.${CONTAINER_NAME:-testar-prod}.entrypoints=web"
      - "traefik.http.services.${CONTAINER_NAME:-testar-prod}.loadbalancer.server.port=80"
      - "traefik.http.middlewares.${CONTAINER_NAME:-testar-prod}-strip.stripprefix.prefixes=${PATH_PREFIX:-/testar}"
      - "traefik.http.routers.${CONTAINER_NAME:-testar-prod}.middlewares=${CONTAINER_NAME:-testar-prod}-strip"
    networks:
      - web

networks:
  web:
    external: true
